<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tu Empresa — Importación y Exportación de Coches Premium</title>
  <meta name="description" content="Importamos y exportamos coches premium a medida desde Europa y EE.UU. Inspección, logística, matriculación y garantía. Pide presupuesto sin compromiso." />

  <!-- OpenGraph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Tu Empresa — Coches Premium Importados" />
  <meta property="og:description" content="Vehículos verificados, importación rápida y garantía europea. Solicita tu coche a medida." />
  <meta property="og:image" content="https://tudominio.com/og-image.jpg" />
  <meta property="og:url" content="https://tudominio.com/" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Tu Empresa — Coches Premium Importados" />
  <meta name="twitter:description" content="Vehículos verificados, importación rápida y garantía europea. Solicita tu coche a medida." />
  <meta name="twitter:image" content="https://tudominio.com/og-image.jpg" />

  <!-- JSON-LD Organization -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Tu Empresa",
    "url": "https://tudominio.com",
    "logo": "https://tudominio.com/logo.png",
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+34 600 000 000",
      "contactType": "customer service",
      "availableLanguage": ["Spanish","English"]
    }
  }
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --primary:#6366F1; --primary-dark:#4F46E5; --bg:#F9FAFB; --text:#111827; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
    header{background:#fff;position:sticky;top:0;z-index:10;border-bottom:1px solid #eee}
    nav{max-width:1200px;margin:0 auto;padding:16px 24px;display:flex;justify-content:space-between;align-items:center}
    nav a{margin:0 12px;text-decoration:none;color:var(--text);font-weight:600;transition:.2s}
    nav a:hover{color:var(--primary)}
    .btn{display:inline-block;padding:12px 22px;border-radius:999px;text-decoration:none;font-weight:600;transition:.2s}
    .btn.primary{background:var(--primary);color:#fff}
    .btn.primary:hover{background:var(--primary-dark)}
    section{max-width:1200px;margin:0 auto;padding:80px 24px}
    h1,h2{margin-bottom:16px;font-weight:700}
    h1{font-size:2.5rem;line-height:1.2}
    h2{font-size:1.8rem;text-align:center}
    p{margin-bottom:12px}
    .hero{display:grid;grid-template-columns:1fr 1fr;gap:40px;align-items:center}
    .hero img{width:100%;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.08)}
    @media(max-width:900px){.hero{grid-template-columns:1fr;text-align:center}}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px;margin-top:40px}
    .card{background:#fff;border-radius:16px;padding:24px;box-shadow:0 4px 12px rgba(0,0,0,.06);transition:.2s}
    .card:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.1)}
    .card img{width:100%;border-radius:12px;margin-bottom:12px}
    form{background:#fff;padding:32px;border-radius:16px;box-shadow:0 4px 16px rgba(0,0,0,.08);max-width:600px;margin:40px auto 0}
    label{font-weight:600;display:block;margin-top:10px}
    input,textarea{width:100%;padding:14px;margin:6px 0 14px;border:1px solid #ddd;border-radius:12px;font-size:1rem;font-family:inherit}
    input:focus,textarea:focus{border-color:var(--primary);outline:none;box-shadow:0 0 0 2px rgba(99,102,241,.2)}
    button{background:var(--primary);color:#fff;border:none;padding:14px 24px;border-radius:999px;font-weight:600;cursor:pointer;transition:.2s}
    button:hover{background:var(--primary-dark)}
    footer{background:#fff;border-top:1px solid #eee;text-align:center;padding:24px;margin-top:40px;font-size:.9rem;color:#555}
  </style>
</head>
<body>
  <!-- NAV -->
  <header>
    <nav role="navigation" aria-label="Menú principal">
      <div><strong style="font-size:1.2rem;color:var(--primary)">Tu Empresa</strong></div>
      <div>
        <a href="#servicios">Servicios</a>
        <a href="#stock">Stock</a>
        <a href="#contacto" class="btn primary">Contacto</a>
      </div>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero" role="region" aria-label="Presentación principal">
    <div>
      <h1>Importación y Exportación de Coches Premium</h1>
      <p>Encuentra el coche que buscas desde Europa o EE.UU. Nos encargamos de transporte, aduanas, matriculación y garantía.</p>
      <a href="#contacto" class="btn primary">Solicitar información</a>
    </div>
    <div>
      <img src="https://picsum.photos/seed/coche1/800/500" alt="Ejemplo de coche premium importado" loading="lazy">
    </div>
  </section>

  <!-- SERVICIOS -->
  <section id="servicios" aria-labelledby="servicios-title">
    <h2 id="servicios-title">Servicios</h2>
    <div class="grid">
      <article class="card"><h3>Búsqueda a medida</h3><p>Encontramos el coche que quieres con historial verificado.</p></article>
      <article class="card"><h3>Transporte y aduanas</h3><p>Gestión logística completa hasta tu puerta.</p></article>
      <article class="card"><h3>Matriculación</h3><p>Nos encargamos de ITV y papeles en España.</p></article>
    </div>
  </section>

  <!-- STOCK -->
  <section id="stock" aria-labelledby="stock-title">
    <h2 id="stock-title">Coches disponibles</h2>
    <div class="grid" id="stock-grid" role="list"></div>
  </section>

  <!-- CONTACTO -->
  <section id="contacto" aria-labelledby="contacto-title">
    <h2 id="contacto-title">Contacto</h2>
    <form id="contact-form" aria-label="Formulario de contacto">
      <label for="nombre">Nombre</label>
      <input type="text" id="nombre" name="nombre" placeholder="Nombre" required>
      <label for="email">Email</label>
      <input type="email" id="email" name="email" placeholder="Email" required>
      <label for="telefono">Teléfono (opcional)</label>
      <input type="tel" id="telefono" name="telefono" placeholder="Teléfono (opcional)">
      <label for="mensaje">Mensaje</label>
      <textarea id="mensaje" name="mensaje" placeholder="Mensaje" required></textarea>

      <!-- Hidden fields -->
      <input type="hidden" name="car_id" id="car_id">
      <input type="hidden" name="coche_interes" id="coche_interes">
      <!-- honeypot -->
      <input type="text" name="company" autocomplete="off" tabindex="-1" style="position:absolute; left:-10000px;">

      <button type="submit" id="submit-btn">Enviar</button>
      <p id="form-status" aria-live="polite" style="margin-top:12px;text-align:center;"></p>
    </form>
  </section>

  <!-- FOOTER -->
  <footer>
    © 2025 Tu Empresa · Importación y Exportación de Coches
  </footer>

  <!-- JS -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // Credenciales (las tuyas actuales)
    const SUPABASE_URL  = "https://swzizabjkzllxwbrcsnp.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3eml6YWJqa3psbHh3YnJjc25wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4MTU5MTUsImV4cCI6MjA3MTM5MTkxNX0.VDQH9t34ij9BAzV-pd0kXFUru179d1b21VNeV7VlkjA";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

    const grid = document.getElementById("stock-grid");

    const cardHTML = (c) => {
      const titulo  = `${c.marca ?? ""} ${c.modelo ?? ""} ${c.anio ?? ""}`.trim();
      const imgSrc  = (Array.isArray(c.imagenes) && c.imagenes[0]) ? c.imagenes[0] : "https://picsum.photos/seed/placeholder/800/450";
      const km      = (c.km ?? 0).toLocaleString("es-ES");
      const resumen = [km && `${km} km`, c.combustible, c.caja].filter(Boolean).join(" · ");
      const precio  = c.precio_objetivo ? `${Number(c.precio_objetivo).toLocaleString("es-ES")} €` : "Bajo pedido";

      return `
        <article class="card" role="listitem">
          <a href="car.html?id=${c.id}" aria-label="Ver ${titulo}">
            <img src="${imgSrc}" alt="${titulo}" loading="lazy">
          </a>
          <div style="padding:10px">
            <b>${titulo}</b><br>
            <span>${resumen}</span><br>
            <span class="tag">${precio}</span>
          </div>
        </article>
      `;
    };

    async function cargarCoches() {
      if (!grid) return;
      grid.innerHTML = "<p>Cargando coches…</p>";

      const { data, error } = await supabase
        .from("cars")
        .select("id, marca, modelo, version, anio, km, combustible, caja, imagenes, precio_objetivo, created_at, estado_publicacion")
        .in("estado_publicacion", ["publicado", "disponible"])   // acepta ambos
        .order("created_at", { ascending: false })
        .limit(12);

      console.log({ data, error, count: data?.length });

      if (error) {
        console.error(error);
        grid.innerHTML = `<p style="color:#b91c1c">Error cargando coches.</p>`;
        return;
      }
      if (!data || data.length === 0) {
        grid.innerHTML = `<p style="color:#6B7280">No hay coches publicados ahora mismo.</p>`;
        return;
      }
      grid.innerHTML = data.map(cardHTML).join("");
    }

    // Form lead
    const form = document.getElementById("contact-form");
    const btn = document.getElementById("submit-btn");
    const statusEl = document.getElementById("form-status");

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      btn.disabled = true;

      const fd = new FormData(form);
      if (fd.get("company")) { btn.disabled = false; return; } // honeypot

      const payload = {
        nombre: (fd.get("nombre") || "").toString().trim(),
        email: (fd.get("email") || "").toString().trim(),
        telefono: (fd.get("telefono") || "").toString().trim() || null,
        mensaje: (fd.get("mensaje") || "").toString().trim(),
        coche_interes: (fd.get("coche_interes") || "").toString().trim() || null,
        car_id: (fd.get("car_id") || "").toString().trim() || null,
        page_url: location.href,
        user_agent: navigator.userAgent
      };

      if (!payload.nombre || !payload.email || !payload.mensaje) {
        statusEl.textContent = "Por favor, rellena nombre, email y mensaje.";
        btn.disabled = false;
        return;
      }

      const { error } = await supabase.from("leads").insert([payload]);
      if (error) {
        console.error("[Supabase INSERT error]", error);
        statusEl.textContent = "Error al enviar (BBDD). Intenta de nuevo.";
        btn.disabled = false;
        return;
      }

      try {
        await fetch("/api/notify-lead", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
      } catch (err) {
        console.warn("Fallo al notificar por email (opcional):", err);
      }

      statusEl.textContent = "¡Gracias! Te contactaremos en breve.";
      form.reset();
      btn.disabled = false;
    });

    cargarCoches();
  </script>
</body>
</html>
